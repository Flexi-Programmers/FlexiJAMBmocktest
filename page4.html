<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flexi CBT – Exam</title>
<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#f2f2f2;
}

/* ===== HEADER ===== */
.header{
  background:#1b5e20;
  color:white;
  padding:10px 14px;
  display:flex;
  flex-direction:column;
  gap:6px;
  box-shadow:0 2px 5px rgba(0,0,0,0.2);
}

#candName{
  font-size:15px;
  font-weight:bold;
  text-align:left;
}

/* tools row */
.header-tools{
  display:flex;
  align-items:center;
  gap:12px;
}

/* Calculator icon */
.calc-icon{
  width:32px;
  height:32px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
.calc-icon:hover{ opacity:0.8; }

/* Timer */
.timer-container{
  display:flex;
  flex-direction:column;
  gap:3px;
}

.timer-wrap{
  width:160px;
  height:10px;
  background:#8e0000;
  border-radius:20px;
  overflow:hidden;
}
.timer-bar{
  height:100%;
  width:100%;
  background:#ff5252;
  transition:width 1s linear;
}

.time-text{
  font-size:12px;
  font-weight:bold;
  text-align:right;
}

/* ===== SUBJECT TABS ===== */
#subjectTabs {
  display: flex;
  flex-wrap: wrap;       /* allow wrapping */
  gap: 10px;             /* space between tabs */
  justify-content: center; /* center tabs horizontally */
  margin-bottom: 20px;
}

.subject-tab {
  padding: 8px 16px;
  border-radius: 20px;       /* rounded edges */
  border: 2px solid #0b6623;
  background: white;
  cursor: pointer;
  text-align: center;
  min-width: 100px;          /* optional fixed width */
  font-weight: bold;
  transition: all 0.2s ease;
}

.subject-tab:hover {
  background: #e6f2e6;
}

.subject-tab.active {
  background: #0b6623;
  color: white;
  transform: scale(1.05);   /* subtle zoom effect for active */
}

/* ===== MAIN ===== */
.main{
  padding:12px;
}

.question-box{
  background:white;
  padding:12px;
  border-radius:6px;
  border:1px solid #ccc;
}

.question-text{
  font-weight:bold;
  margin-bottom:10px;
}

/* OPTIONS */
.option{
  border:1px solid #1b5e20;
  padding:8px;
  border-radius:5px;
  margin-bottom:8px;
  cursor:pointer;
}
.option.selected{
  background:#c8e6c9;
}

/* ===== QUESTION NUMBERS ===== */
.qnums{
  display:flex;
  flex-wrap:wrap;
  margin-top:10px;
}
.qnum{
  width:30px;
  height:30px;
  line-height:30px;
  margin:4px;
  text-align:center;
  color:white;
  font-weight:bold;
  border-radius:4px;
  cursor:pointer;
}
.qnum.red{ background:#d32f2f; }
.qnum.green{ background:#388e3c; }

/* Navigation container */
.nav-buttons {
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
  gap: 12px;
}

/* Previous & Next buttons */
.nav-buttons button {
  flex: 1;
  padding: 14px 0;
  font-size: 15px;
  font-weight: 600;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: background 0.2s ease, transform 0.1s ease;
}

/* Previous button */
#prevBtn {
  background: #e0e0e0;
  color: #333;
}

#prevBtn:hover {
  background: #d5d5d5;
}

/* Next button */
#nextBtn {
  background: #0f9d58; /* CBT green */
  color: #fff;
}

#nextBtn:hover {
  background: #0c7c45;
}

/* Click effect */
.nav-buttons button:active {
  transform: scale(0.98);
}

/* ===== SUBMIT ===== */
.submit{
  margin-top:10px;
  width:100%;
  padding:10px;
  background:#d32f2f;
  color:white;
  font-weight:bold;
  border:none;
  border-radius:4px;
  cursor:pointer;
}

/* ===== CALCULATOR MODAL ===== */
.calc-modal{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.5);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}
.calc-box{
  background:white;
  padding:15px;
  width:280px;
  border-radius:8px;
}
.calc-screen{
  width:100%;
  height:40px;
  margin-bottom:10px;
  font-size:18px;
  padding:5px;
}
.calc-keys{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:6px;
}
.calc-keys button{
  padding:12px;
  font-size:16px;
  cursor:pointer;
}
.close-calc{
  margin-top:8px;
  width:100%;
  padding:8px;
  background:#d32f2f;
  color:white;
  border:none;
  cursor:pointer;
}
.option-circle {
  display: block;
  width: 100%;
  padding: 12px 16px;
  margin: 8px 0;
  border-radius: 50px; /* fully rounded edges */
  border: 2px solid #ccc;
  background-color: #fff;
  text-align: left;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 16px;
}

.option-circle.selected {
  background-color: #4caf50; /* green when selected */
  color: #fff;
  border-color: #4caf50;
}

.option-circle:hover {
  background-color: #e0e0e0;
}

.qnum.current {
  border: 2px solid #0b6623;
  background: #e6f4ea;
  color: #0b6623;
  font-weight: bold;
  transform: scale(1.05);
}
</style>
</head>

<body>

<!-- ===== HEADER ===== -->
<div class="header">
  <div id="candName">Flexi Tutors JAMB CBT Mock</div>

  <div class="header-tools">
    <!-- CALCULATOR ICON -->
    <div class="calc-icon" onclick="openCalc()">
      <svg viewBox="0 0 64 64" width="22" height="22" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
        <rect x="4" y="2" width="56" height="60" rx="4" ry="4"></rect>
        <rect x="10" y="8" width="44" height="10" rx="2" ry="2"></rect>

        <rect x="10" y="22" width="8" height="8"></rect>
        <rect x="22" y="22" width="8" height="8"></rect>
        <rect x="34" y="22" width="8" height="8"></rect>
        <rect x="46" y="22" width="8" height="8"></rect>

        <rect x="10" y="34" width="12" height="10"></rect>
        <line x1="13" y1="39" x2="19" y2="39"></line>
        <line x1="16" y1="36" x2="16" y2="42"></line>

        <rect x="26" y="34" width="12" height="10"></rect>
        <line x1="29" y1="39" x2="35" y2="39"></line>

        <rect x="42" y="34" width="12" height="22"></rect>
        <line x1="45" y1="43" x2="51" y2="43"></line>
        <line x1="45" y1="48" x2="51" y2="48"></line>
      </svg>
    </div>

    <!-- TIMER -->
    <div class="timer-container">
      <div class="timer-wrap">
        <div class="timer-bar" id="timerBar"></div>
      </div>
      <div class="time-text" id="timeText">00:20:00</div>
    </div>
  </div>
</div>

<!-- SUBJECT TABS -->
<div class="subject-tabs" id="subjectTabs"></div>

<!-- MAIN -->
<div class="main">
  <div class="question-box">
    <div class="question-text" id="questionText"></div>
    <div id="options"></div>
  </div>

  <div class="qnums" id="qnums"></div>

<div id="options"></div>

 <div class="nav-buttons">
  <button id="prevBtn" onclick="prevQ()">Previous</button>
  <button id="nextBtn" onclick="nextQ()">Next</button>
</div>

  <button class="submit" onclick="submitExam()">Submit</button>
</div>

<!-- CALCULATOR MODAL -->
<div class="calc-modal" id="calcModal">
  <div class="calc-box">
    <input class="calc-screen" id="calcScreen" readonly>
    <div class="calc-keys">
      <button onclick="press('7')">7</button>
      <button onclick="press('8')">8</button>
      <button onclick="press('9')">9</button>
      <button onclick="press('/')">÷</button>

      <button onclick="press('4')">4</button>
      <button onclick="press('5')">5</button>
      <button onclick="press('6')">6</button>
      <button onclick="press('*')">×</button>

      <button onclick="press('1')">1</button>
      <button onclick="press('2')">2</button>
      <button onclick="press('3')">3</button>
      <button onclick="press('-')">-</button>

      <button onclick="press('0')">0</button>
      <button onclick="press('.')">.</button>
      <button onclick="calculate()">=</button>
      <button onclick="press('+')">+</button>
    </div>
    <button class="close-calc" onclick="closeCalc()">Close</button>
  </div>
</div>

<script>
/* ===== EXAM DATA ===== */
const examData = {
  English: [ {"question": "Neither the complaints nor the warnings ___ able to deter the principal.", "options": {"A": "were", "B": "are", "C": "was", "D": "have been"}, "answer": "C"}, {"question": "'Hardly had the bell rung when the students rushed out' illustrates", "options": {"A": "conditional clause", "B": "inversion structure", "C": "gerund phrase", "D": "relative clause"}, "answer": "B"}, {"question": "The dominant irony in The Lekki Headmaster is", "options": {"A": "poor leadership improves school", "B": "discipline enforced by flawed system", "C": "students reject education", "D": "teachers dominate admin"}, "answer": "B"}, {"question": "Choose the correct synonym of 'Obfuscate'", "options": {"A": "Clarify", "B": "Confuse", "C": "Simplify", "D": "Reveal"}, "answer": "B"}, {"question": "Identify the type of conjunction: 'Neither nor'", "options": {"A": "Coordinating", "B": "Subordinating", "C": "Correlative", "D": "Conjunctive adverb"}, "answer": "C"}, {"question": "Choose the correct passive form: 'They will finish the work by Monday'", "options": {"A": "The work will be finished by Monday", "B": "The work is finished by Monday", "C": "The work has been finished by Monday", "D": "The work being finished by Monday"}, "answer": "A"}, {"question": "Which word is an antonym of 'Candid'?", "options": {"A": "Frank", "B": "Honest", "C": "Deceitful", "D": "Direct"}, "answer": "C"}, {"question": "Select the correct sentence with proper concord:", "options": {"A": "The team are winning", "B": "The team is winning", "C": "The team were winning", "D": "The team has winning"}, "answer": "B"}, {"question": "Identify the error: 'She don’t like to play football'", "options": {"A": "She", "B": "don’t", "C": "like", "D": "football"}, "answer": "B"}, {"question": "Select the correct word: 'He has a very ___ nature.'", "options": {"A": "amiable", "B": "amiably", "C": "amity", "D": "amicably"}, "answer": "A"}, {"question": "Choose the correct spelling", "options": {"A": "Occurence", "B": "Occurrence", "C": "Ocurrence", "D": "Ocurrence"}, "answer": "B"}, {"question": "Identify the figurative language: 'The wind whispered through the trees'", "options": {"A": "Metaphor", "B": "Personification", "C": "Simile", "D": "Alliteration"}, "answer": "B"}, {"question": "Choose the correct sentence:", "options": {"A": "If I was you, I would go", "B": "If I were you, I would go", "C": "If I am you, I would go", "D": "If I be you, I would go"}, "answer": "B"}, {"question": "Select the synonym for 'Abate'", "options": {"A": "Increase", "B": "Reduce", "C": "Intensify", "D": "Prolong"}, "answer": "B"}, {"question": "Identify the tense: 'She had been reading for two hours'", "options": {"A": "Past perfect continuous", "B": "Past continuous", "C": "Present perfect", "D": "Future perfect"}, "answer": "A"}, {"question": "Select the correct preposition: 'He is good ___ mathematics'", "options": {"A": "in", "B": "at", "C": "on", "D": "for"}, "answer": "B"}, {"question": "Choose the correct article: '___ apple a day keeps the doctor away'", "options": {"A": "A", "B": "An", "C": "The", "D": "No article"}, "answer": "B"}, {"question": "Select the correct form: 'I wish I ___ taller'", "options": {"A": "was", "B": "were", "C": "am", "D": "be"}, "answer": "B"}, {"question": "Identify the rhetorical device: 'I came, I saw, I conquered'", "options": {"A": "Anaphora", "B": "Alliteration", "C": "Epistrophe", "D": "Metaphor"}, "answer": "A"}, {"question": "Choose the correct idiom meaning 'to be overjoyed'", "options": {"A": "On cloud nine", "B": "Under the weather", "C": "In hot water", "D": "Break the ice"}, "answer": "A"} 
  ],
Mathematics: [ {"question": "If the roots of x² − kx + 9 = 0 are equal, find √(k² − 36).", "options": {"A": "0", "B": "3", "C": "6", "D": "9"}, "answer": "A"}, {"question": "√(3x + 4) + √(x − 1) = 5. Find x.", "options": {"A": "3", "B": "4", "C": "5", "D": "6"}, "answer": "B"}, {"question": "(2^(x+1) − 2^x) / 2^(x−1) = 6. Find x.", "options": {"A": "2", "B": "3", "C": "4", "D": "5"}, "answer": "B"}, {"question": "Simplify √(12 + 2√35) − √7.", "options": {"A": "√5", "B": "√3", "C": "√7", "D": "1"}, "answer": "A"}, {"question": "If α and β are roots of 2x² − 7x + 3 = 0, find 1/α + 1/β.", "options": {"A": "7/3", "B": "3/2", "C": "7", "D": "2"}, "answer": "A"}, {"question": "Evaluate (16^(3/4) × 8^(2/3)) ÷ 4^(1/2).", "options": {"A": "16", "B": "32", "C": "64", "D": "128"}, "answer": "C"}, {"question": "If x = √5 + 2, find 1/x.", "options": {"A": "√5 − 2", "B": "2 − √5", "C": "(√5 + 2)/9", "D": "1/(√5 + 2)"}, "answer": "A"}, {"question": "Find the quadratic equation whose roots are 2 ± √3.", "options": {"A": "x² − 4x + 1 = 0", "B": "x² − 4x + 7 = 0", "C": "x² − 4x − 1 = 0", "D": "x² + 4x + 1 = 0"}, "answer": "B"}, {"question": "2^x + 2^(x+1) + 2^(x+2) = 56. Find x.", "options": {"A": "2", "B": "3", "C": "4", "D": "5"}, "answer": "C"}, {"question": "Simplify (√18 + √8) / √2.", "options": {"A": "5", "B": "6", "C": "7", "D": "8"}, "answer": "B"}, {"question": "If x^2 − 5x + 6 = 0, find the sum of the roots.", "options": {"A": "5", "B": "6", "C": "-5", "D": "-6"}, "answer": "A"}, {"question": "Solve for x: 3^(2x) = 81.", "options": {"A": "1", "B": "2", "C": "3", "D": "4"}, "answer": "C"}, {"question": "If (2x−1)(x+3)=0, find the values of x.", "options": {"A": "1/2, −3", "B": "−1/2, 3", "C": "1, −3", "D": "−1, 3"}, "answer": "A"}, {"question": "Simplify √50 + √18.", "options": {"A": "7√2", "B": "8√2", "C": "9√2", "D": "10√2"}, "answer": "B"}, {"question": "If x^2 + 4x + 4 = 0, find the root.", "options": {"A": "−2", "B": "2", "C": "−4", "D": "4"}, "answer": "A"}, {"question": "Evaluate 2^(3) × 2^(4).","options": {"A": "8", "B": "16", "C": "128", "D": "256"}, "answer": "C"}, {"question": "Simplify √72 − √8.", "options": {"A": "4√2", "B": "6√2", "C": "8√2", "D": "2√2"}, "answer": "B"}, {"question": "Solve 5^(x−1) = 25.", "options": {"A": "2", "B": "3", "C": "4", "D": "5"}, "answer": "B"}, {"question": "Find roots of x^2 − x − 6 = 0.", "options": {"A": "3, −2", "B": "2, −3", "C": "1, −6", "D": "6, −1"}, "answer": "B"}, {"question": "Simplify (√32 × √2).","options": {"A": "8", "B": "16", "C": "4", "D": "32"}, "answer": "A"} ],
Chemistry: [ {"question": "Which of the following is a pure substance?", "options": {"A": "Air", "B": "Oxygen", "C": "Sea water", "D": "Soil"}, "answer": "B"}, {"question": "The process of separating a soluble solid from a liquid by evaporation is called", "options": {"A": "Filtration", "B": "Distillation", "C": "Evaporation", "D": "Decantation"}, "answer": "C"}, {"question": "Which separation technique is suitable for separating cream from milk?", "options": {"A": "Filtration", "B": "Centrifugation", "C": "Sublimation", "D": "Evaporation"}, "answer": "B"}, {"question": "Which of the following is an impure substance?", "options": {"A": "Gold", "B": "Sodium chloride", "C": "Brass", "D": "Hydrogen"}, "answer": "C"}, {"question": "A mixture of sand and salt can be separated by", "options": {"A": "Filtration and evaporation", "B": "Sublimation", "C": "Distillation", "D": "Chromatography"}, "answer": "A"}, {"question": "Which method is used to separate alcohol from water?", "options": {"A": "Filtration", "B": "Distillation", "C": "Evaporation", "D": "Decantation"}, "answer": "B"}, {"question": "Sublimation is used to purify", "options": {"A": "Salt", "B": "Ammonium chloride", "C": "Sand", "D": "Sugar"}, "answer": "B"}, {"question": "Chromatography is used to separate", "options": {"A": "Components of a mixture", "B": "Salt from water", "C": "Sand from water", "D": "Alcohol from water"}, "answer": "A"}, {"question": "Decantation is suitable for separating", "options": {"A": "Oil from water", "B": "Salt from water", "C": "Alcohol from water", "D": "Ammonium chloride from sand"}, "answer": "A"}, {"question": "Which technique is used to separate iron from a mixture of iron and sulphur?", "options": {"A": "Filtration", "B": "Magnetic separation", "C": "Decantation", "D": "Distillation"}, "answer": "B"}, {"question": "Which method separates immiscible liquids?", "options": {"A": "Evaporation", "B": "Distillation", "C": "Separating funnel", "D": "Filtration"}, "answer": "C"}, {"question": "Filtration is used to separate", "options": {"A": "Salt from water", "B": "Sand from water", "C": "Alcohol from water", "D": "Oil from water"}, "answer": "B"}, {"question": "The process of condensing a vapor back to liquid is called", "options": {"A": "Evaporation", "B": "Condensation", "C": "Distillation", "D": "Filtration"}, "answer": "B"}, {"question": "Which method is used to purify a solid by heating until it turns to vapor and then cooling?", "options": {"A": "Sublimation", "B": "Filtration", "C": "Distillation", "D": "Decantation"}, "answer": "A"}, {"question": "Which technique separates coloured substances based on solubility?", "options": {"A": "Filtration", "B": "Chromatography", "C": "Decantation", "D": "Evaporation"}, "answer": "B"}, {"question": "Simple distillation is used when the boiling points of two liquids are", "options": {"A": "Close together", "B": "Very different", "C": "Same", "D": "None of the above"}, "answer": "B"}, {"question": "Evaporation is used to obtain", "options": {"A": "Pure liquid", "B": "Solid from solution", "C": "Mixture of liquids", "D": "Gas from liquid"}, "answer": "B"}, {"question": "A solution of salt in water can be separated by", "options": {"A": "Decantation", "B": "Filtration", "C": "Evaporation", "D": "Magnetic separation"}, "answer": "C"}, {"question": "Which technique separates a mixture by allowing the solvent to move up a stationary medium?", "options": {"A": "Filtration", "B": "Chromatography", "C": "Evaporation", "D": "Decantation"}, "answer": "B"}, {"question": "Magnetic separation is suitable for separating", "options": {"A": "Sand and iron", "B": "Salt and water", "C": "Alcohol and water", "D": "Oil and water"}, "answer": "A"} ],
Accounting: [ {"question": "Which of the following is a principle of double entry?", "options": {"A": "Every debit has a corresponding credit", "B": "Every account has a credit only", "C": "Every account has a debit only", "D": "All assets are liabilities"}, "answer": "A"}, {"question": "If cash is received from a debtor, which accounts are affected?", "options": {"A": "Cash and Revenue", "B": "Cash and Debtors", "C": "Debtors and Expenses", "D": "Cash and Capital"}, "answer": "B"}, {"question": "Which account shows the owner’s investment in the business?", "options": {"A": "Capital", "B": "Revenue", "C": "Expense", "D": "Drawings"}, "answer": "A"}, {"question": "A credit entry increases which type of account?", "options": {"A": "Asset", "B": "Liability", "C": "Expense", "D": "Drawings"}, "answer": "B"}, {"question": "The purchase of furniture on credit affects which accounts?", "options": {"A": "Furniture and Cash", "B": "Furniture and Creditors", "C": "Cash and Creditors", "D": "Furniture and Capital"}, "answer": "B"}, {"question": "Which account is debited when rent is paid in cash?", "options": {"A": "Cash", "B": "Rent Expense", "C": "Capital", "D": "Revenue"}, "answer": "B"}, {"question": "Which of the following is a nominal account?", "options": {"A": "Capital", "B": "Revenue", "C": "Cash", "D": "Debtors"}, "answer": "B"}, {"question": "The account that records all increases and decreases of an asset is", "options": {"A": "Personal account", "B": "Nominal account", "C": "Real account", "D": "Capital account"}, "answer": "C"}, {"question": "The purchase of goods for cash is recorded by debiting", "options": {"A": "Cash", "B": "Purchases", "C": "Capital", "D": "Revenue"}, "answer": "B"}, {"question": "If a debtor pays part of his debt, which accounts are affected?", "options": {"A": "Debtors and Revenue", "B": "Cash and Debtors", "C": "Cash and Revenue", "D": "Cash and Capital"}, "answer": "B"}, {"question": "The drawing of cash by the owner is recorded by debiting", "options": {"A": "Cash", "B": "Capital", "C": "Drawings", "D": "Revenue"}, "answer": "C"}, {"question": "Which account is credited when goods are sold on credit?", "options": {"A": "Revenue", "B": "Debtors", "C": "Cash", "D": "Purchases"}, "answer": "A"}, {"question": "The trial balance is prepared to", "options": {"A": "Determine profit", "B": "Check the arithmetical accuracy of accounts", "C": "Record transactions", "D": "Prepare financial statements"}, "answer": "B"}, {"question": "Which of the following increases an asset?", "options": {"A": "Payment of debt", "B": "Receipt of cash from debtor", "C": "Owner withdrawal", "D": "Payment of expense"}, "answer": "B"}, {"question": "Capital introduced by the owner is recorded by", "options": {"A": "Debiting Capital", "B": "Crediting Capital", "C": "Debiting Cash", "D": "Crediting Revenue"}, "answer": "B"}, {"question": "Which account is credited when salaries are paid?", "options": {"A": "Salary Expense", "B": "Cash", "C": "Capital", "D": "Revenue"}, "answer": "B"}, {"question": "The purchase of goods on credit increases which account?", "options": {"A": "Purchases", "B": "Debtors", "C": "Creditors", "D": "Revenue"}, "answer": "C"}, {"question": "Which of the following is an example of a real account?", "options": {"A": "Cash", "B": "Revenue", "C": "Capital", "D": "Drawings"}, "answer": "A"}, {"question": "A revenue account records", "options": {"A": "Assets", "B": "Expenses", "C": "Incomes", "D": "Liabilities"}, "answer": "C"}, {"question": "Double entry ensures that", "options": {"A": "Only assets are recorded", "B": "Debits equal credits", "C": "Only liabilities are recorded", "D": "Revenue is ignored"}, "answer": "B"} ],
Commerce: [ {"question": "Which of the following best defines commerce?", "options": {"A": "The study of business only", "B": "The process of buying and selling goods and services", "C": "Accounting for businesses", "D": "Banking only"}, "answer": "B"}, {"question": "The primary function of commerce is", "options": {"A": "Production of goods", "B": "Distribution of goods", "C": "Accounting", "D": "Tax collection"}, "answer": "B"}, {"question": "Which of the following is an example of occupation?", "options": {"A": "Teaching", "B": "Banking", "C": "Farming", "D": "All of the above"}, "answer": "D"}, {"question": "Commerce helps in", "options": {"A": "Reducing time in distribution", "B": "Increasing cost", "C": "Decreasing production", "D": "Reducing employment"}, "answer": "A"}, {"question": "The term 'trade' refers to", "options": {"A": "All business activities", "B": "Buying and selling of goods", "C": "Banking activities", "D": "Insurance activities"}, "answer": "B"}, {"question": "Which of these is a service of commerce?", "options": {"A": "Transport", "B": "Factory production", "C": "Farming", "D": "Mining"}, "answer": "A"}, {"question": "Commerce includes", "options": {"A": "Trade only", "B": "Auxiliary services only", "C": "Trade and auxiliary services", "D": "Production only"}, "answer": "C"}, {"question": "Banking is considered", "options": {"A": "A form of trade", "B": "A form of commerce service", "C": "Production activity", "D": "An occupation unrelated to commerce"}, "answer": "B"}, {"question": "Insurance is necessary in commerce because", "options": {"A": "It increases risk", "B": "It protects against losses", "C": "It reduces sales", "D": "It avoids production"}, "answer": "B"}, {"question": "Occupation refers to", "options": {"A": "A leisure activity", "B": "A regular work by a person to earn a living", "C": "A hobby", "D": "A trade only"}, "answer": "B"}, {"question": "Trade can be classified into", "options": {"A": "Internal and external", "B": "Wholesale and retail", "C": "Both A and B", "D": "None of the above"}, "answer": "C"}, {"question": "Commerce provides", "options": {"A": "Goods only", "B": "Services only", "C": "Goods and services", "D": "Employment only"}, "answer": "C"}, {"question": "Which of the following is an auxiliary service to trade?", "options": {"A": "Insurance", "B": "Farming", "C": "Manufacturing", "D": "Construction"}, "answer": "A"}, {"question": "Transport is important in commerce because", "options": {"A": "It reduces the value of goods", "B": "It moves goods from producer to consumer", "C": "It creates production", "D": "It discourages trade"}, "answer": "B"}, {"question": "Warehousing helps in", "options": {"A": "Storage of goods", "B": "Production only", "C": "Reducing sales", "D": "Manufacturing"}, "answer": "A"}, {"question": "Occupation provides", "options": {"A": "Income", "B": "Goods only", "C": "Trade only", "D": "Nothing"}, "answer": "A"}, {"question": "Commerce improves", "options": {"A": "Production efficiency", "B": "Employment opportunities", "C": "Both A and B", "D": "None of the above"}, "answer": "C"}, {"question": "Which of these is a type of trade?", "options": {"A": "Wholesale", "B": "Retail", "C": "Both A and B", "D": "None"}, "answer": "C"}, {"question": "Services that facilitate trade are called", "options": {"A": "Auxiliary services", "B": "Primary services", "C": "Secondary services", "D": "Trade only"}, "answer": "A"}, {"question": "Commerce exists to", "options": {"A": "Reduce production", "B": "Facilitate exchange of goods and services", "C": "Increase taxes", "D": "Reduce trade"}, "answer": "B"} ],
Physics: [ {"question": "Which of the following is a scalar quantity?", "options": {"A": "Force", "B": "Velocity", "C": "Mass", "D": "Displacement"}, "answer": "C"}, {"question": "Which of the following is a vector quantity?", "options": {"A": "Speed", "B": "Temperature", "C": "Acceleration", "D": "Energy"}, "answer": "C"}, {"question": "The magnitude of a vector is always", "options": {"A": "Negative", "B": "Zero", "C": "Positive", "D": "Imaginary"}, "answer": "C"}, {"question": "Resultant of two forces acting along the same line is", "options": {"A": "Sum or difference", "B": "Product", "C": "Quotient", "D": "None"}, "answer": "A"}, {"question": "The direction of a scalar is", "options": {"A": "Same as vector", "B": "None", "C": "Always zero", "D": "Along x-axis"}, "answer": "B"}, {"question": "A body acted upon by two equal and opposite forces experiences", "options": {"A": "Acceleration", "B": "No acceleration", "C": "Displacement", "D": "Velocity"}, "answer": "B"}, {"question": "Unit of force in SI system is", "options": {"A": "Newton", "B": "Joule", "C": "Pascal", "D": "Watt"}, "answer": "A"}, {"question": "Two vectors are perpendicular. Their resultant is given by", "options": {"A": "√(A^2 + B^2)", "B": "A + B", "C": "A - B", "D": "AB"}, "answer": "A"}, {"question": "Scalar quantities have", "options": {"A": "Magnitude only", "B": "Direction only", "C": "Magnitude and direction", "D": "None"}, "answer": "A"}, {"question": "The vector sum of two equal and opposite vectors is", "options": {"A": "Zero", "B": "Double", "C": "Equal to one vector", "D": "Undefined"}, "answer": "A"}, {"question": "The SI unit of mass is", "options": {"A": "Kg", "B": "N", "C": "J", "D": "m"}, "answer": "A"}, {"question": "The magnitude of the resultant of two vectors at right angles is", "options": {"A": "Sum", "B": "Difference", "C": "√(A^2 + B^2)", "D": "Zero"}, "answer": "C"}, {"question": "Force and acceleration are related by", "options": {"A": "Newton’s second law", "B": "Newton’s first law", "C": "Newton’s third law", "D": "Hooke’s law"}, "answer": "A"}, {"question": "The component of a vector along x-axis is called", "options": {"A": "X-component", "B": "Y-component", "C": "Magnitude", "D": "Direction"}, "answer": "A"}, {"question": "Vector quantities include", "options": {"A": "Speed, mass", "B": "Velocity, force", "C": "Time, distance", "D": "Energy, temperature"}, "answer": "B"}, {"question": "Two forces of magnitude 3 N and 4 N act at right angles. Their resultant is", "options": {"A": "5 N", "B": "7 N", "C": "1 N", "D": "12 N"}, "answer": "A"}, {"question": "The scalar product of two perpendicular vectors is", "options": {"A": "Zero", "B": "Positive", "C": "Negative", "D": "Undefined"}, "answer": "A"}, {"question": "The angle between two vectors whose resultant is maximum is", "options": {"A": "0°", "B": "90°", "C": "180°", "D": "45°"}, "answer": "A"}, {"question": "The resultant of two vectors acting along the same direction is", "options": {"A": "Sum", "B": "Difference", "C": "Product", "D": "Zero"}, "answer": "A"}, {"question": "The magnitude of a vector can never be", "options": {"A": "Negative", "B": "Zero", "C": "Positive", "D": "None of the above"}, "answer": "A"} ],
Biology: [ {"question": "Which organelle is known as the powerhouse of the cell?", "options": {"A": "Nucleus", "B": "Mitochondria", "C": "Ribosome", "D": "Endoplasmic Reticulum"}, "answer": "B"}, {"question": "Which organelle controls all cell activities?", "options": {"A": "Nucleus", "B": "Mitochondria", "C": "Ribosome", "D": "Golgi body"}, "answer": "A"}, {"question": "Ribosomes are responsible for", "options": {"A": "Protein synthesis", "B": "Respiration", "C": "Lipid synthesis", "D": "Waste removal"}, "answer": "A"}, {"question": "The semi-permeable membrane surrounding the cell is called", "options": {"A": "Cell wall", "B": "Plasma membrane", "C": "Nucleus", "D": "Cytoplasm"}, "answer": "B"}, {"question": "Which organelle modifies and packages proteins?", "options": {"A": "Golgi apparatus", "B": "Ribosome", "C": "Mitochondria", "D": "Nucleus"}, "answer": "A"}, {"question": "Which cell organelle contains digestive enzymes?", "options": {"A": "Lysosome", "B": "Mitochondria", "C": "Ribosome", "D": "Golgi body"}, "answer": "A"}, {"question": "Which organelle stores water and other substances in plant cells?", "options": {"A": "Vacuole", "B": "Lysosome", "C": "Chloroplast", "D": "Nucleus"}, "answer": "A"}, {"question": "Which organelle contains chlorophyll?", "options": {"A": "Chloroplast", "B": "Mitochondria", "C": "Ribosome", "D": "Golgi body"}, "answer": "A"}, {"question": "Which structure maintains the shape of plant cells?", "options": {"A": "Cell wall", "B": "Plasma membrane", "C": "Vacuole", "D": "Cytoplasm"}, "answer": "A"}, {"question": "The fluid portion of the cell that supports organelles is called", "options": {"A": "Cytoplasm", "B": "Nucleoplasm", "C": "Vacuole", "D": "Cell wall"}, "answer": "A"}, {"question": "Which organelle is involved in lipid synthesis?", "options": {"A": "Smooth ER", "B": "Rough ER", "C": "Mitochondria", "D": "Golgi apparatus"}, "answer": "A"}, {"question": "Which organelle is responsible for packaging materials for export out of the cell?", "options": {"A": "Golgi apparatus", "B": "Ribosome", "C": "Nucleus", "D": "Lysosome"}, "answer": "A"}, {"question": "Which organelle contains the genetic material of the cell?", "options": {"A": "Nucleus", "B": "Mitochondria", "C": "Ribosome", "D": "Vacuole"}, "answer": "A"}, {"question": "Which structure is present only in plant cells and not in animal cells?", "options": {"A": "Chloroplast", "B": "Mitochondria", "C": "Ribosome", "D": "Lysosome"}, "answer": "A"}, {"question": "Which organelle is involved in cellular respiration?", "options": {"A": "Mitochondria", "B": "Ribosome", "C": "Nucleus", "D": "Golgi apparatus"}, "answer": "A"}, {"question": "Which organelle is responsible for the synthesis of RNA?", "options": {"A": "Nucleolus", "B": "Nucleus", "C": "Ribosome", "D": "Mitochondria"}, "answer": "A"}, {"question": "Which organelle helps in detoxification in liver cells?", "options": {"A": "Smooth ER", "B": "Rough ER", "C": "Mitochondria", "D": "Golgi apparatus"}, "answer": "A"}, {"question": "Which organelle is the site of photosynthesis?", "options": {"A": "Chloroplast", "B": "Mitochondria", "C": "Ribosome", "D": "Vacuole"}, "answer": "A"}, {"question": "Which organelle is responsible for protein folding and transport?", "options": {"A": "Rough ER", "B": "Smooth ER", "C": "Mitochondria", "D": "Golgi body"}, "answer": "A"}, {"question": "Which organelle contains enzymes that break down waste products?", "options": {"A": "Lysosome", "B": "Golgi apparatus", "C": "Vacuole", "D": "Smooth ER"}, "answer": "A"} ],
Literature_in_English: [ {"question": "The main purpose of drama is to", "options": {"A": "Tell a story", "B": "Provide amusement", "C": "Present life realistically", "D": "All of the above"}, "answer": "D"}, {"question": "In prose, the narrative point of view can be", "options": {"A": "First person", "B": "Third person", "C": "Omniscient", "D": "All of the above"}, "answer": "D"}, {"question": "A tragedy in drama typically ends", "options": {"A": "Happily", "B": "Unhappily", "C": "Unchanged", "D": "Comically"}, "answer": "B"}, {"question": "Dialogue in drama is used to", "options": {"A": "Develop character", "B": "Advance the plot", "C": "Reveal conflict", "D": "All of the above"}, "answer": "D"}, {"question": "Prose fiction includes", "options": {"A": "Novels", "B": "Short stories", "C": "Both A and B", "D": "Poems"}, "answer": "C"}, {"question": "The climax of a play is", "options": {"A": "The introduction", "B": "The turning point", "C": "The conclusion", "D": "The dialogue"}, "answer": "B"}, {"question": "In drama, the setting helps", "options": {"A": "Create mood", "B": "Establish time and place", "C": "Support the plot", "D": "All of the above"}, "answer": "D"}, {"question": "Conflict in drama is important because", "options": {"A": "It entertains", "B": "It drives the plot", "C": "It confuses the audience", "D": "It ends the story"}, "answer": "B"}, {"question": "Foreshadowing in prose means", "options": {"A": "Hinting at future events", "B": "Explaining the past", "C": "Describing characters", "D": "Presenting setting"}, "answer": "A"}, {"question": "A protagonist is", "options": {"A": "The main character", "B": "The villain", "C": "A minor character", "D": "The narrator"}, "answer": "A"}, {"question": "Dramatic irony occurs when", "options": {"A": "The audience knows something the characters do not", "B": "The characters know everything", "C": "The plot is predictable", "D": "There is no conflict"}, "answer": "A"}, {"question": "In prose, characterization is achieved through", "options": {"A": "Dialogue", "B": "Action", "C": "Narration", "D": "All of the above"}, "answer": "D"}, {"question": "Comedy in drama is meant to", "options": {"A": "Make the audience laugh", "B": "Make the audience cry", "C": "Create suspense", "D": "Introduce tragedy"}, "answer": "A"}, {"question": "The resolution in a play", "options": {"A": "Solves the main conflict", "B": "Introduces a new character", "C": "Creates suspense", "D": "Climaxes the story"}, "answer": "A"}, {"question": "Exposition in drama refers to", "options": {"A": "Background information", "B": "Conflict", "C": "Climax", "D": "Dialogue"}, "answer": "A"}, {"question": "In prose, the narrator’s reliability can be", "options": {"A": "Reliable", "B": "Unreliable", "C": "Both A and B", "D": "None"}, "answer": "C"}, {"question": "Symbolism in drama is used to", "options": {"A": "Represent abstract ideas", "B": "Decorate the stage", "C": "Replace dialogue", "D": "None of the above"}, "answer": "A"}, {"question": "A subplot in drama", "options": {"A": "Supports the main plot", "B": "Distracts from the story", "C": "Introduces a new genre", "D": "Ends the story"}, "answer": "A"}, {"question": "Prose as a literary form is different from poetry because", "options": {"A": "It has regular rhyme", "B": "It is written in sentences and paragraphs", "C": "It uses stanzas", "D": "It rhymes consistently"}, "answer": "B"}, {"question": "The purpose of a narrator in prose is to", "options": {"A": "Tell the story", "B": "Interpret events", "C": "Provide perspective", "D": "All of the above"}, "answer": "D"} ],

  Government: [ {"question": "Which branch of government makes laws?", "options": {"A": "Executive", "B": "Legislature", "C": "Judiciary", "D": "Civil service"}, "answer": "B"}, {"question": "Which branch of government interprets laws?", "options": {"A": "Executive", "B": "Legislature", "C": "Judiciary", "D": "Civil service"}, "answer": "C"}, {"question": "Separation of powers prevents", "options": {"A": "Corruption", "B": "Abuse of power", "C": "Legislation", "D": "Political parties"}, "answer": "B"}, {"question": "Political socialization is the process of", "options": {"A": "Teaching citizens about politics", "B": "Voting in elections", "C": "Running government offices", "D": "Making laws"}, "answer": "A"}, {"question": "The Executive branch is responsible for", "options": {"A": "Making laws", "B": "Enforcing laws", "C": "Interpreting laws", "D": "Judging cases"}, "answer": "B"}, {"question": "Judicial review is performed by", "options": {"A": "Legislature", "B": "Executive", "C": "Judiciary", "D": "Civil service"}, "answer": "C"}, {"question": "A constitution typically", "options": {"A": "Separates powers", "B": "Unites powers", "C": "Limits political participation", "D": "Repeals laws"}, "answer": "A"}, {"question": "Political socialization occurs through", "options": {"A": "Family and schools", "B": "Media", "C": "Peers and political parties", "D": "All of the above"}, "answer": "D"}, {"question": "The principle of checks and balances ensures", "options": {"A": "One branch dominates", "B": "Branches can monitor each other", "C": "Political parties compete", "D": "Legislature controls everything"}, "answer": "B"}, {"question": "Civil servants are part of which branch?", "options": {"A": "Executive", "B": "Judiciary", "C": "Legislature", "D": "Political parties"}, "answer": "A"}, {"question": "Separation of powers is intended to", "options": {"A": "Concentrate authority", "B": "Distribute authority", "C": "Prevent elections", "D": "Control media"}, "answer": "B"}, {"question": "Political socialization helps citizens", "options": {"A": "Understand government", "B": "Participate in politics", "C": "Develop civic values", "D": "All of the above"}, "answer": "D"}, {"question": "Which is an example of legislative power?", "options": {"A": "Passing a new law", "B": "Appointing judges", "C": "Enforcing taxes", "D": "Hearing cases"}, "answer": "A"}, {"question": "Executive powers include", "options": {"A": "Making laws", "B": "Executing laws", "C": "Judging disputes", "D": "Amending constitution"}, "answer": "B"}, {"question": "Political culture is transmitted by", "options": {"A": "Family", "B": "Schools", "C": "Media", "D": "All of the above"}, "answer": "D"}, {"question": "The judiciary can limit executive power through", "options": {"A": "Judicial review", "B": "Passing laws", "C": "Voting", "D": "Political campaigns"}, "answer": "A"}, {"question": "Separation of powers originated to", "options": {"A": "Promote dictatorship", "B": "Prevent tyranny", "C": "Encourage corruption", "D": "Limit elections"}, "answer": "B"}, {"question": "Political socialization can include", "options": {"A": "Learning political norms", "B": "Adopting political beliefs", "C": "Understanding civic duties", "D": "All of the above"}, "answer": "D"}, {"question": "A major benefit of separation of powers is", "options": {"A": "Checks and balances", "B": "Concentration of authority", "C": "Political manipulation", "D": "Unaccountability"}, "answer": "A"}, {"question": "Which agency often assists in political socialization through civic education?", "options": {"A": "Electoral commission", "B": "Legislature", "C": "Military", "D": "Judiciary"}, "answer": "A"} ],
  Economics: [ { "question": "Economics is mainly concerned with", "options": { "A": "The study of money only", "B": "Production, distribution, and consumption of goods and services", "C": "The study of politics", "D": "Religious teachings" }, "answer": "B" }, { "question": "The basic economic problem arises because", "options": { "A": "Resources are limited while wants are unlimited", "B": "People are lazy", "C": "Governments do not plan", "D": "Markets are always efficient" }, "answer": "A" }, { "question": "A traditional economic system primarily relies on", "options": { "A": "Customs and traditions to allocate resources", "B": "Market forces", "C": "Government planning", "D": "Technological innovation" }, "answer": "A" }, { "question": "In a command economy, economic decisions are made by", "options": { "A": "Individuals and households", "B": "Market forces", "C": "The government", "D": "Foreign investors" }, "answer": "C" }, { "question": "A market economy is characterized by", "options": { "A": "Government ownership of resources", "B": "Private ownership and free competition", "C": "Traditional customs", "D": "Random allocation of resources" }, "answer": "B" }, { "question": "Scarcity in economics means", "options": { "A": "There are not enough resources to satisfy all wants", "B": "Resources are unlimited", "C": "Wants are limited", "D": "People have too much money" }, "answer": "A" }, { "question": "Opportunity cost refers to", "options": { "A": "The money spent on goods", "B": "The next best alternative foregone", "C": "The total cost of production", "D": "The benefit of producing one more unit" }, "answer": "B" }, { "question": "A mixed economy combines", "options": { "A": "Tradition and technology", "B": "Market forces and government intervention", "C": "Only government planning", "D": "Random distribution and free market" }, "answer": "B" }, { "question": "Production in economics involves", "options": { "A": "Creating goods and services", "B": "Consuming goods", "C": "Saving money", "D": "Setting prices only" }, "answer": "A" }, { "question": "Distribution in economics refers to", "options": { "A": "How goods and services are allocated among people", "B": "How goods are produced", "C": "The total national income", "D": "Government taxation only" }, "answer": "A" }, { "question": "Economic systems exist to", "options": { "A": "Solve the problem of scarcity", "B": "Make laws", "C": "Control population", "D": "Enforce religion" }, "answer": "A" }, { "question": "In a free market economy, prices are determined by", "options": { "A": "The government only", "B": "Supply and demand", "C": "International organizations", "D": "Customary practices" }, "answer": "B" }, { "question": "Economic agents include", "options": { "A": "Households, firms, and government", "B": "Only the government", "C": "Only firms", "D": "Only households" }, "answer": "A" }, { "question": "The law of demand states that, ceteris paribus,", "options": { "A": "As price increases, quantity demanded increases", "B": "As price decreases, quantity demanded increases", "C": "Price has no effect on demand", "D": "Quantity demanded is always constant" }, "answer": "B" }, { "question": "Economic growth refers to", "options": { "A": "Increase in a country's population", "B": "Increase in the production of goods and services", "C": "Increase in taxes", "D": "Decrease in unemployment" }, "answer": "B" }, { "question": "A command economy is also called", "options": { "A": "Market economy", "B": "Planned economy", "C": "Traditional economy", "D": "Mixed economy" }, "answer": "B" }, { "question": "Efficiency in economics means", "options": { "A": "Resources are wasted", "B": "Maximum output is obtained from available resources", "C": "Prices are low", "D": "All people have equal wealth" }, "answer": "B" }, { "question": "An economic system that relies on customs is", "options": { "A": "Traditional system", "B": "Command system", "C": "Market system", "D": "Mixed system" }, "answer": "A" }, { "question": "The primary function of money in an economy is to", "options": { "A": "Serve as a medium of exchange", "B": "Be hoarded", "C": "Increase taxes", "D": "Control population" }, "answer": "A" }, { "question": "The allocation of scarce resources to satisfy unlimited wants is called", "options": { "A": "Production", "B": "Consumption", "C": "Distribution", "D": "Economics" }, "answer": "D" } ]
};
</script>
<script type="module">
/* ================= FIREBASE ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, doc, setDoc, serverTimestamp }
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCPumFid5YNTWug52q2VDtSDQTLU9REgss",
  authDomain: "flexi-tutors.firebaseapp.com",
  projectId: "flexi-tutors",
  storageBucket: "flexi-tutors.firebasestorage.app",
  messagingSenderId: "320176672406",
  appId: "1:320176672406:web:90f19511241e51c6437cb7",
  measurementId: "G-Z9P1G4K0SY"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ================= CORE VARIABLES ================= */
const candidateName = localStorage.getItem("candidateName");
let selectedSubjects = JSON.parse(localStorage.getItem("selectedSubjects"));

if (!candidateName || !selectedSubjects || selectedSubjects.length !== 4) {
  alert("Session error. Please restart exam.");
  window.location.href = "page1.html";
}

selectedSubjects = selectedSubjects.map(s => s.trim());

let filteredExamData = {};
selectedSubjects.forEach(sub => {
  if (!examData[sub]) console.error("Missing subject:", sub);
  else filteredExamData[sub] = examData[sub];
});

const subjects = Object.keys(filteredExamData);
if (subjects.length !== 4) {
  alert("Subject loading error. Restart exam.");
  window.location.href = "page1.html";
}

/* ================= SHUFFLE UTILS ================= */
function shuffleArray(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

/* ================= SHUFFLE QUESTIONS ================= */
subjects.forEach(sub => {
  filteredExamData[sub] = shuffleArray(filteredExamData[sub]);
});

/* ================= OPTION ORDER ================= */
const optionOrder = {};
subjects.forEach(sub => {
  optionOrder[sub] = {};
  filteredExamData[sub].forEach((q, i) => {
    optionOrder[sub][i] = shuffleArray(Object.keys(q.options));
  });
});

/* ================= EXAM STATE ================= */
let currentSubject = subjects[0];
let qIndex = 0;
let answers = {};
subjects.forEach(s => {
  answers[s] = Array(filteredExamData[s].length).fill(null);
});

/* ================= RESTORE SESSION ================= */
const savedAnswers = JSON.parse(localStorage.getItem("cbt_answers"));
if (savedAnswers) answers = savedAnswers;

const savedSubject = localStorage.getItem("cbt_currentSubject");
const savedIndex = localStorage.getItem("cbt_qIndex");

if (savedSubject && subjects.includes(savedSubject)) currentSubject = savedSubject;
if (savedIndex !== null) qIndex = parseInt(savedIndex, 10);

/* ================= AUTOSAVE ================= */
function autoSave() {
  localStorage.setItem("cbt_answers", JSON.stringify(answers));
  localStorage.setItem("cbt_currentSubject", currentSubject);
  localStorage.setItem("cbt_qIndex", qIndex);
}

/* ================= SUBJECT TABS ================= */
const tabsBox = document.getElementById("subjectTabs");
tabsBox.innerHTML = "";
subjects.forEach(sub => {
  const tab = document.createElement("div");
  tab.className = "subject-tab";
  if (sub === currentSubject) tab.classList.add("active");
  tab.textContent = sub;
  tab.onclick = () => switchSubject(sub);
  tabsBox.appendChild(tab);
});

/* ================= RENDER ================= */
function render() {
  const q = filteredExamData[currentSubject][qIndex];
  document.getElementById("questionText").textContent =
    `${qIndex + 1}. ${q.question}`;

  const optBox = document.getElementById("options");
  optBox.innerHTML = "";

  optionOrder[currentSubject][qIndex].forEach(key => {
    const btn = document.createElement("button");
    btn.className = "option-circle";
    btn.textContent = q.options[key];

    if (answers[currentSubject][qIndex] === key)
      btn.classList.add("selected");

    btn.onclick = () => {
      answers[currentSubject][qIndex] = key;
      autoSave();
      render();
    };

    optBox.appendChild(btn);
  });

  renderNums();
}

/* ================= QUESTION NUMBERS ================= */
function renderNums() {
  const box = document.getElementById("qnums");
  box.innerHTML = "";

  filteredExamData[currentSubject].forEach((_, i) => {
    const n = document.createElement("div");

    // Base: answered / not answered
    n.className = "qnum " + (answers[currentSubject][i] !== null ? "green" : "red");

    // Current question highlight
    if (i === qIndex) n.classList.add("current");

    n.textContent = i + 1;
    n.onclick = () => { qIndex = i; autoSave(); render(); };
    box.appendChild(n);
  });
}

/* ================= SUBJECT SWITCH ================= */
function switchSubject(sub) {
  currentSubject = sub;
  qIndex = 0;

  document.querySelectorAll(".subject-tab")
    .forEach(t => t.classList.remove("active"));

  [...tabsBox.children]
    .find(t => t.textContent === sub)
    .classList.add("active");

  autoSave();
  render();
}

/* ================= NAV BUTTONS ================= */
document.getElementById("prevBtn")?.addEventListener("click", () => {
  if (qIndex > 0) { qIndex--; autoSave(); render(); }
});
document.getElementById("nextBtn")?.addEventListener("click", () => {
  if (qIndex < filteredExamData[currentSubject].length - 1) { qIndex++; autoSave(); render(); }
});

/* ================= TIMER WITH BLINK ================= */
const total = 20 * 60; // 20 minutes
const endTime = Date.now() + total * 1000;
const timerEl = document.getElementById("timeText");

const timerInterval = setInterval(() => {
  const left = Math.max(Math.floor((endTime - Date.now()) / 1000), 0);
  const m = Math.floor(left / 60);
  const s = left % 60;

  timerEl.textContent = `00:${m.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;

  // Blink effect when last 60 seconds
  if (left <= 60) {
    timerEl.style.visibility = (Math.floor(left * 2) % 2 === 0) ? "visible" : "hidden";
  } else {
    timerEl.style.visibility = "visible";
  }

  document.getElementById("timerBar").style.width = (left / total) * 100 + "%";

  if (left <= 0) finalizeSubmission("timeout");
}, 500);

/* ================= SCORING ================= */
function calculateScore() {
  let raw = 0, totalQ = 0;
  subjects.forEach(sub => {
    filteredExamData[sub].forEach((q,i) => {
      totalQ++;
      if (answers[sub][i] !== null) raw += answers[sub][i] === q.answer ? 1 : -0.25;
    });
  });
  if (raw < 0) raw = 0;
  return { rawScore: raw.toFixed(2), jambScore: Math.round((raw/totalQ)*400) };
}

/* ================= FINAL SUBMIT ================= */
async function finalizeSubmission(reason) {
  if (localStorage.getItem("cbt_submitted") === "true") return;
  clearInterval(timerInterval);

  const result = calculateScore();
  try {
    await setDoc(doc(db, "cbtResults", `${candidateName}_${Date.now()}`), {
      name: candidateName,
      subjects,
      answers,
      rawScore: result.rawScore,
      jambScore: result.jambScore,
      submitReason: reason,
      submittedAt: serverTimestamp()
    });
    localStorage.setItem("cbt_submitted", "true");
    window.location.href = "page5.html";
  } catch (err) {
    alert("Submission failed. Contact invigilator.");
    console.error(err);
  }
}

/* ================= AUTO SUBMIT ON APP SWITCH ================= */
document.addEventListener("visibilitychange", () => {
  if (document.hidden) {
    alert("You left the exam. Auto-submitting.");
    finalizeSubmission("auto");
  }
});

/* ================= MANUAL SUBMIT ================= */
window.submitExam = () => finalizeSubmission("manual");

/* ================= CALCULATOR ================= */
window.openCalc = () => document.getElementById("calcModal").style.display = "flex";
window.closeCalc = () => document.getElementById("calcModal").style.display = "none";
window.press = v => document.getElementById("calcScreen").value += v;
window.calculate = () => {
  try { document.getElementById("calcScreen").value = eval(document.getElementById("calcScreen").value); }
  catch { document.getElementById("calcScreen").value = "Error"; }
};

/* ================= INIT ================= */
render();
</script>
</body>
</html>